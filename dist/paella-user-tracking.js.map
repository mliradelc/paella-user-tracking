{"version":3,"file":"paella-user-tracking.js","mappings":"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","sources":["webpack://paella-user-tracking/webpack/universalModuleDefinition","webpack://paella-user-tracking/./src/plugins/UserTrackingPlugins.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.analytics.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.debug.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.userEventTracker.js","webpack://paella-user-tracking/./src/plugins/org.opencast.paella.opencast.matomoTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/ sync \\.js","webpack://paella-user-tracking/external umd {\"commonjs\":\"paella-core\",\"commonjs2\":\"paella-core\",\"amd\":\"paella-core\"}","webpack://paella-user-tracking/webpack/bootstrap","webpack://paella-user-tracking/webpack/runtime/compat get default export","webpack://paella-user-tracking/webpack/runtime/define property getters","webpack://paella-user-tracking/webpack/runtime/hasOwnProperty shorthand","webpack://paella-user-tracking/webpack/runtime/make namespace object","webpack://paella-user-tracking/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"paella-core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"paella-core\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"paella-user-tracking\"] = factory(require(\"paella-core\"));\n\telse\n\t\troot[\"paella-user-tracking\"] = factory(root[undefined]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__995__) => {\nreturn ","import {Â PluginModule } from \"paella-core\";\nimport packageData from \"../../package.json\";\n\nexport default class UserTrackingPlugins extends PluginModule {\n    get moduleName() {\n        return \"paella-user-tracking\";\n    }\n\n    get moduleVersion() {\n        return packageData.version;\n    }\n}","\nimport { DataPlugin  } from \"paella-core\";\n\nexport default class AnalyticsUserTrackingDataPlugin extends DataPlugin {\n    async load() {\n        const trackingId = this.config.trackingId;\n        const domain = this.config.domain || \"auto\";\n        if (trackingId) {\n            this.player.log.debug(\"Google Analytics Enabled\");\n            /* jshint ignore:start */\n            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n                (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n                })(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');\n            /* jshint ignore:end */\n            __gaTracker('create', trackingId, domain);\n            __gaTracker('send', 'pageview');\n        }\n        else {\n            this.player.log.debug(\"No Google Tracking ID found in config file. Disabling Google Analytics\");\n        }\n    }\n    \n    async write(context, { id }, data) {\n        if (this.config.category === undefined || this.config.category === true) {\n            const category = this.config.category || \"PaellaPlayer\";\n            const action = data.event;\n            const labelData = {\n                videoId: id,\n                plugin: data.plugin\n            }\n\n            try {\n                // Test if data parameters can be serialized\n                JSON.stringify(data.params);\n                labelData.params = data.params;\n            }\n            catch(e) {}\n\n            const label = JSON.stringify(labelData);\n\n            __gaTracker(' send', 'event', category, action, label);\n        }\n    }\n}","\nimport { DataPlugin } from 'paella-core';\n\nexport default class DebugUserTrackingDataPlugin extends DataPlugin {\n    async write(context, { id }, data) {\n        console.log(`id: ${ id }`, context, data);\n    }\n}\n","import { Events, EventLogPlugin } from 'paella-core';\n\n//const eventKeys = Object.keys(Events);\n\nconst getPaellaEvents = (events) => events.map(eventName => Events[eventName]);\n\nexport default class UserEventTrackerPlugin extends EventLogPlugin {\n\tget events() {\n\t\tif (this.config.events) {\n\t\t\treturn getPaellaEvents(this.config.events);\n\t\t}\n\t\telse {\n\t\t\treturn [\n\t\t\t\tEvents.PLAY,\n\t\t\t\tEvents.PAUSE,\n\t\t\t\tEvents.SEEK,\n\t\t\t\tEvents.STOP,\n\t\t\t\tEvents.ENDED,\n\t\t\t\tEvents.FULLSCREEN_CHANGED,\n\t\t\t\tEvents.VOLUME_CHANGED,\n\t\t\t\tEvents.BUTTON_PRESS,\n\t\t\t\tEvents.RESIZE_END\n\t\t\t]\n\t\t}\n\t}\n\n\tasync onEvent(event, params) {\n\t\tconst id = this.player.videoId;\n\t\t// Remove plugin reference to avoid circular references\n\t\tif (params.plugin) {\n\t\t\tconst { name, config } = params.plugin;\n\t\t\tparams.plugin = { name, config }\n\t\t}\n\t\tconst trackingData = { event, params }\n\n\t\tswitch (event) {\n\t\tcase Events.SHOW_POPUP:\n\t\tcase Events.HIDE_POPUP:\n\t\tcase Events.BUTTON_PRESS:\n\t\t\ttrackingData.plugin = params.plugin?.name || null;\n\t\t}\n\n\t\tconst context = this.config.context || \"userTracking\";\n\t\tawait this.player.data.write(\n\t\t\tcontext,\n\t\t\t{ id },\n\t\t\ttrackingData\n\t\t);\n\t}\n}\n","/**\n * Licensed to The Apereo Foundation under one or more contributor license\n * agreements. See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n *\n * The Apereo Foundation licenses this file to you under the Educational\n * Community License, Version 2.0 (the \"License\"); you may not use this file\n * except in compliance with the License. You may obtain a copy of the License\n * at:\n *\n *   http://opensource.org/licenses/ecl2.txt\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n * License for the specific language governing permissions and limitations under\n * the License.\n *\n */\nimport { DataPlugin, Events, bindEvent } from 'paella-core';\n\nexport default class OpencastMatomoTrackingDataPlugin extends DataPlugin {\n\n  async isEnabled() {\n    if (!(await super.isEnabled())) {\n      return false;\n    }\n    else {\n      const response = await fetch('/usertracking/detailenabled');\n      const data = await response.text();\n      const enabled = /true/i.test(data);\n      return enabled;\n    }\n  }\n\n  async load(){\n    const client_id = this.config.client_id;\n    const heartbeat = this.config.heartbeat;\n    const tracking_client = this.config.tracking_client;\n    var server = this.config.server;\n    const site_id = this.config.site_id;\n\n\n\n    let matomoPromise = null;\n    const matomoScript = (path) => {\n      if (!matomoPromise){\n        matomoPromise = new Promise((resolve) => {\n          const script = document.createElement('script');\n          script.type = 'text/javascript';\n          script.src = path;\n          let loaded = false;\n          script.onload = script.onreadystatechange = () => {\n            if (!loaded) {\n              loaded = true;\n              resolve();\n            }\n          };\n          document.head.appendChild(script);\n        });\n      }\n      return matomoPromise;\n    };\n\n    if (server.substr(-1) != '/') server += '/';\n    await matomoScript(server + tracking_client + '.js');\n    this.player.matomotracker = Matomo.getAsyncTracker( server + tracking_client + '.php', site_id );\n    //this.player.log.debug('Matomo Analytics Initialized: ' + Matomo.initialized);\n    this.player.matomotracker.client_id = client_id;\n    if (heartbeat && heartbeat > 0) this.player.matomotracker.enableHeartBeatTimer(heartbeat);\n    if (Matomo && Matomo.MediaAnalytics) {\n      bindEvent(this.player,\n        Events.STREAM_LOADED,\n        () => {\n          Matomo.MediaAnalytics.scanForMedia();\n        });\n      this.registerVisit();\n    }\n  }\n\n  async write(context, { id }, data) {\n    const currentTime = await this.player.videoContainer.currentTime();\n    this.player.log.debug(`Logging event for video id ${ id } at time: ${ currentTime }`);\n\n    switch (data.event) {\n    case Events.PLAY:\n      this.player.matomotracker.trackEvent('Player.Controls', 'Play', this.loadTitle());\n      break;\n    case Events.PAUSE:\n      this.player.matomotracker.trackEvent('Player.Controls', 'Pause', this.loadTitle());\n      break;\n    case Events.ENDED:\n      this.player.matomotracker.trackEvent('Player.Status', 'Ended', this.loadTitle());\n      break;\n    case (Events.FULLSCREEN_CHANGED):\n      if (data.params.status == true){\n        this.player.matomotracker.trackEvent('Player.View', 'Fullscreen', this.loadTitle());\n      } else {\n        this.player.matomotracker.trackEvent('Player.View', 'ExitFullscreen', this.loadTitle());\n      }\n      break;\n    case Events.PLAYER_LOADED:\n      this.player.matomotracker.trackEvent('Player.Status', 'LoadComplete', this.loadTitle());\n      break;\n    case Events.SHOW_POPUP:\n      this.player.matomotracker.trackEvent('Player.PopUp', 'Show', data.params.plugin.name);\n      break;\n    case Events.HIDE_POPUP:\n      this.player.matomotracker.trackEvent('Player.PopUp', 'Hide', data.params.plugin.name);\n      break;\n    case Events.SEEK:\n      this.player.matomotracker.trackEvent('Player.Controls', 'Seek', Math.round(data.params.newTime));\n      break;\n    case Events.VOLUME_CHANGED:\n      this.player.matomotracker.trackEvent('Player.Settings', 'Volume', data.params.volume);\n      break;\n    case Events.RESIZE_END:\n      this.player.matomotracker.trackEvent('Player.View', 'Resize', `${ data.params.size.w }x${ data.params.size.h }`);\n      break;\n    case Events.CAPTIONS_CHANGED:\n      this.player.matomotracker.trackEvent('Player.Captions', 'Enabled', data);\n      break;\n\n    // Bug: Playback rate can't be triggered\n    case Events.PLAYBACK_RATE_CHANGED:\n      this.player.log.info('Playbackrate changed!');\n      this.player.matomotracker.trackEvent('Player.Controls', 'PlaybackRate', data.params.newPlaybackRate);\n      break;\n    }\n  }\n\n  registerVisit() {\n    var opencastData,\n        title,\n        eventId,\n        seriesTitle,\n        seriesId,\n        presenter;\n\n    opencastData = this.player.videoManifest.metadata;\n\n    if (opencastData.UID != undefined && opencastData.title != undefined){\n      title = opencastData.title;\n      eventId = opencastData.UID;\n      presenter = opencastData.presenters;\n      this.player.matomotracker.setCustomVariable (5, 'client',\n        (this.player.matomotracker.client_id || 'Paella Opencast'));\n      /* eslint-disable no-unused-vars */\n      Matomo.MediaAnalytics.setMediaTitleFallback(function (mediaElement) {return title;});\n      /* eslint-disable no-unused-vars */\n    }\n\n    if (opencastData != undefined){\n      seriesId = opencastData.series;\n      seriesTitle = opencastData.seriestitle;\n    }\n\n    if (title) this.player.matomotracker.setCustomVariable(1, 'event', title + ' (' + eventId + ')');\n    if (seriesTitle) this.player.matomotracker.setCustomVariable(2, 'series' + seriesTitle + ' (' + seriesId + ')');\n    if (presenter) this.player.matomotracker.setCustomVariable(3, 'presenter', presenter);\n    if (title && presenter){\n      this.player.matomotracker.setDocumentTitle(title + ' - ' + (presenter || 'Unknown'));\n      this.player.matomotracker.trackPageView(title + ' - ' + (presenter || 'Unknown'));\n    } else{\n      this.player.matomotracker.trackPageView();\n    }\n  }\n\n  loadTitle() {\n    var title = this.player.videoManifest.metadata.title;\n    return title;\n  }\n\n\n}\n","var map = {\n\t\"./UserTrackingPlugins.js\": 263,\n\t\"./es.upv.paella.analytics.userTrackingDataPlugin.js\": 561,\n\t\"./es.upv.paella.debug.userTrackingDataPlugin.js\": 931,\n\t\"./es.upv.paella.userEventTracker.js\": 11,\n\t\"./org.opencast.paella.opencast.matomoTrackingDataPlugin.js\": 801\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 757;","module.exports = __WEBPACK_EXTERNAL_MODULE__995__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\nimport GoogleAnalyticsUserTrackingData from './plugins/es.upv.paella.analytics.userTrackingDataPlugin';\nimport DebugUserTrackingData from './plugins/es.upv.paella.debug.userTrackingDataPlugin';\nimport UserEventTracker from './plugins/es.upv.paella.userEventTracker';\nimport matomoTrackingData from './plugins/org.opencast.paella.opencast.matomoTrackingDataPlugin';\n\nexport default function getUserTrackingPluginsContext() {\n    return require.context(\"./plugins\", true, /\\.js/)\n}\n\nexport const GoogleAnalyticsUserTrackingDataPlugin = GoogleAnalyticsUserTrackingData;\nexport const DebugUserTrackingDataPlugin = DebugUserTrackingData;\nexport const UserEventTrackerPlugin = UserEventTracker;\nexport const matomoTrackingDataPlugin = matomoTrackingData;\n"],"names":["root","factory","exports","module","require","define","amd","undefined","self","__WEBPACK_EXTERNAL_MODULE__995__","UserTrackingPlugins","PluginModule","i","AnalyticsUserTrackingDataPlugin","trackingId","this","config","domain","player","log","debug","s","o","g","r","a","m","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","window","document","__gaTracker","context","data","id","category","action","event","labelData","videoId","plugin","JSON","stringify","params","e","label","DataPlugin","DebugUserTrackingDataPlugin","console","UserEventTrackerPlugin","events","map","eventName","Events","name","trackingData","write","EventLogPlugin","OpencastMatomoTrackingDataPlugin","fetch","response","text","enabled","test","client_id","heartbeat","tracking_client","server","site_id","matomoPromise","matomoScript","path","Promise","resolve","script","type","loaded","onload","onreadystatechange","head","appendChild","substr","matomotracker","Matomo","getAsyncTracker","enableHeartBeatTimer","MediaAnalytics","bindEvent","scanForMedia","registerVisit","videoContainer","currentTime","trackEvent","loadTitle","status","Math","round","newTime","volume","size","w","h","info","newPlaybackRate","opencastData","title","eventId","seriesTitle","seriesId","presenter","videoManifest","metadata","UID","presenters","setCustomVariable","setMediaTitleFallback","mediaElement","series","seriestitle","setDocumentTitle","trackPageView","webpackContext","req","webpackContextResolve","__webpack_require__","Error","code","keys","Object","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","key","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","getUserTrackingPluginsContext","GoogleAnalyticsUserTrackingDataPlugin","GoogleAnalyticsUserTrackingData","DebugUserTrackingData","UserEventTracker","matomoTrackingDataPlugin","matomoTrackingData"],"sourceRoot":""}